# 스프링 클라우드 소개

## 스프링 클라우드의 진화

스프링 클라우드 1.0은 넷플릭스 OSS 도구를 기반으로 한다.

- 넷플릭스 유레카: 검색 서버
- 넷플릭스 리본: 클라이언트 측 로드 밸런서
- 넷플릭스 주울: 에지 서버
- 넷플릭스 히스트릭스: 서킷 브레이커

스프링 클라우드는 처음 출시된 이후 성장하며, 다음과 같은 지원 기능이 추가됐다.

- 하시코프 컨설과 아파치 주키퍼 기반의 서비스 검색 및 구성 중앙화
- 스프링 클라우드 스트림을 사용한 EDA
- azure, aws, gcp

2020년 12월 스프링 칼라우드 일퍼드가 출시되면서 넷플릭스 컴포넌트 중 넷플릭스 유레카만 스프링 클라우드에 남게 되었다.

<img width="576" alt="스크린샷 2024-09-26 오후 8 46 43" src="https://github.com/user-attachments/assets/1ff735c9-1ead-4804-a77d-6b5e09f3a7d7">


## 넷플릭스 유레카를 검색 서비스로 사용

스프링 클라우드를 사용해 넷플릭스 유레카에 마이크로서비스를 등록하고, 클라이언트가 RESTful API와 같은 HTTP 요청을 넷플릭스 유레카에 등록된 인스턴스로 전송한다.

## 스프링 클라우드 게이트웨이를 에지 서버로 사용

마이크로서비스 환경을 보호하고자 에지 서버를 사용한다. <br>
스프링 클라우드 게이트웨이가 제공하는 주요 지원 기능은 URL 경로 기반 라우팅과 OAuth 2.0, OpenID Connect에 기반한 엔드포인트 보호 등이다. <br>
스프링 클라우드 게이트웨이는 논블로킹 API를 사용하여 많은 동시 요청을 처리할 수 있다.

<img width="732" alt="스크린샷 2024-09-26 오후 8 51 14" src="https://github.com/user-attachments/assets/10dc255c-fe2f-4f8a-85a3-a1073d3c710d">


## 구성 중앙화를 위해 스프링 클라우드 컨피그 사용

스프링 클라우드 컨피그에는 다음과 같은 다양한 저장소에 구성 파일을 저장할 수 있다.

- 깃 저장소
- 로컬 파일 시스템
- 하시코프 볼트
- JDBD 데이터베이스

스프링 클라우드 컨피그는 구성 변경을 감지하며, **스프링 클라우드 버스**를 사용해 영향받는 마이크로서비스로 알림을 보내는 기능도 지원한다.

<img width="706" alt="스크린샷 2024-09-26 오후 8 53 09" src="https://github.com/user-attachments/assets/763cd4ac-4346-41fd-b688-8e00f4b3a37c">

## 복원력 향상을 위해 Resilience4j 사용

장애가 있는것이 당연하다고 간주하고, 장애를 처리할 수 있도록 시스템 환경을 설계해야 한다. <br>
Resilience4j는 내결함성 메커니즘을 제공하는 오픈 소스 기반 라이브러리다.

- 서킷 브레이커: 원격 서비스가 응답하지 않을 경우 발생하는 연쇄 장애를 방지하고자 사용
- rate limiter: 지정한 시간동안의 서비스 요청 수를 제한하고자 사용
- bulkhead: 서비스에 대한 동시 요청 수를 제한하고자 사용
- retry: 임의의 오류를 처리하고자 사용
- time limiter: 오랫동안 느리거나 응답이 없는 서비스의 응답을 기다리지 않고자 사용

## 스프링 클라우드 슬루스와 집킨을 사용한 분산 추적

스프링 클라우드 슬루스는 상관 ID를 사용해 하나의 처리 흐름에 포함된 요청과 메시지/이벤트에 표시를 남긴다. <br>
또한 하나의 처리 흐름에서 나오는 여러 마이크로서비스의 로그 레코드를 쉽게 추적할 수 있도록 로그 레코드에 상관 ID를 덧붙인다. <br>
스프링 클라우드 슬루스는 추적 데이터를 저장/시각화하고자 집킨으로 보낸다.









